# 制定 WidgetKit 策略

> 在规划实现小组件、控件、手表复杂功能和实时活动时，探索相关功能、任务、相关框架和限制条件。

## 概述

使用 WidgetKit 构建小组件、控件、手表复杂功能和实时活动。当你提供这些系统体验时，你的应用会成为跨平台和设备的小组件生态系统的一部分，并通过占据有限但有效、引人注目的空间来扩大其影响力。以 WidgetKit 为基础的系统体验依赖于一组相关框架，并在设计和功能上具有相似性，这使得它们非常适合代码和设计组件的复用。

为了避免在应用开发过程中产生高昂的变更成本，请在创建设计和编写代码之前规划好 WidgetKit 的采用。在制定计划时，请考虑以下因素：

- 每个平台的功能可用性
- 除了 WidgetKit 之外还需使用的框架
- 小组件、手表复杂功能和实时活动所需的外观和可用尺寸
- 驱动内容更新的技术

## 动画

通过深度链接、按钮和切换与您的应用进行交互
小组件和手表复杂功能的配置选项
在智能叠放中的可见性
功能约束
然后，采用迭代的方式逐步引入 WidgetKit。例如，可以先按照创建小组件扩展中描述的方法，从一个不可配置的 WidgetFamily.systemSmall 小组件开始，因为它能让你的内容在 iPhone、iPad、Mac 和 Apple Vision Pro 的 WidgetKit 生态系统中获得广泛曝光。接下来，再添加对配置、更多小组件尺寸的支持，并根据你的应用功能，加入实时活动或带有手表复杂功能的 watchOS 应用。
查看每个平台的系统体验
小组件有不同的尺寸，从锁屏上的圆形配件小组件和 Apple Watch 上的复杂功能，到 Apple Vision Pro 上的超大号小组件。你可以选择想要支持的尺寸和复杂功能，但建议尽可能支持更多的尺寸和复杂功能。
实况活动可在 iPhone 和 iPad 上使用，并显示在锁屏和支持设备的灵动岛上。此外，实况活动还会显示在配对的 Mac 或 Apple Watch 上，以及 CarPlay 中。当你添加对实况活动的支持时，需要创建最小、紧凑和扩展三种展示方式，以确保你的实况活动在每个平台上都能正确显示。
在 iOS、iPadOS 和 macOS 中，你的应用可以提供用户放置在控制中心的控件。在 Mac 上，用户还可以将控件放在菜单栏作为菜单栏项目。在 Apple Watch 上，你的 watchOS 应用或配对的 iPhone 的控件会显示在控制中心和智能叠放中，用户还可以将它们放在 Apple Watch Ultra 的操作按钮上。
此表显示了每个平台可用的功能：
小组件尺寸或技术
iPhone
iPad
Apple Watch
Mac
Apple Vision Pro
小型系统小组件
主屏幕、今日视图和待机模式
主屏幕、今日视图和锁定屏幕
否
是
是
中号系统小组件
主屏幕和今日视图
主屏幕和今日视图
否
是
是
大型系统小组件
主屏幕和今日视图
主屏幕和今日视图
否
是
是
超大系统小组件
否
主屏幕和今日视图
否
是
是
超大系统小组件（纵向）
否
否
否
否
是
圆形配件小组件
锁屏
锁屏
手表复杂功能和智能叠放
否
否
角落配件小组件
否
否
手表复杂功能
否
否
矩形配件小组件
锁屏
锁屏
手表复杂功能和智能叠放
否
否
内联配件小组件
锁屏
锁屏
手表复杂功能
否
否
实时活动
是
是
来自配对的 iPhone
来自配对的 iPhone
否
控件
是
是
是
是
否
利用其他框架
小组件、手表复杂功能、控件和实时活动都使用你在 Xcode 项目中添加的小组件扩展。WidgetKit 的作用是为其支持的功能提供基础设施和配置。根据你支持的功能和平台，结合其他框架一起使用 WidgetKit，如下所示：
要为每个功能创建用户界面，请使用 SwiftUI。
要为小组件和实时活动添加交互性，请使用 SwiftUI 和 App Intents 框架。
要提供表盘复杂功能和 watchOS 小组件，请创建一个 watchOS 应用。
要提供可配置的小组件和表盘复杂功能，请使用 App Intents。
要为系统提供用于智能叠放的上下文线索并提供小组件建议，请使用 App Intents 和 RelevanceKit。
要启动、更新和结束实时活动，请使用 ActivityKit。
支持不同的外观
根据不同的使用场景，小组件或实时活动会改变其外观，以更好地适应当前环境。例如，WidgetFamily.systemSmall 小组件的外观如下：
在 iPhone 和 iPad 的主屏幕上，它会针对浅色和深色外观使用 accented 渲染模式，而在运行 iOS 和 iPad 18 或更早版本的设备上，则使用 fullColor。
在 iPad 和 iPhone 的锁屏界面上，使用 vibrant 渲染模式，呈现出鲜明、模糊的外观。在 iPhone 的锁屏待机和夜间模式待机界面上，使用 vibrant 渲染模式，并以放大尺寸显示。
在 CarPlay 中，使用 fullColor 渲染模式，并移除背景，以放大尺寸显示。
在 Mac 上，使用 accented 渲染模式。在较早版本的 macOS 上，则使用 fullColor 或 vibrant 模式。
同样，WidgetFamily.accessoryRectangular 小组件的显示效果如下：
在 iPhone 和 iPad 的锁定屏幕上，它呈现出 vibrant 的外观。
在 Apple Watch 上，它会以无背景和 accented 外观的表盘复杂功能显示，并在智能叠放中以 fullColor 外观显示。
每当你为应用添加新功能时，请确保你的小组件、手表复杂功能或实时活动能够良好地支持所有适用的使用场景和外观。欲了解更多信息，请参阅为更多平台、场景和外观准备小组件 。如需设计指导，请参阅人机界面指南 > 小组件 。
为内容更新添加动画
小组件和实时活动可以使用动画（包括自定义动画）来吸引用户关注数据更新。欲了解更多信息，请参阅在小组件和实时活动中为数据更新添加动画 。
提供最新的信息
小组件和手表复杂功能使用的内容更新机制与您的应用不同。它们使用您在应用中创建并交给 WidgetKit 的数据时间线。随着您的应用接收新数据，您需要维护这条时间线，但为了优化设备的电池寿命，每个应用都有更新其小组件或复杂功能的预算。此外，系统会批量处理并调度更新以节省电量。有关时间线的工作原理以及如何保持小组件和手表复杂功能内容最新的更多信息，请参阅保持小组件内容最新和在小组件扩展中进行网络请求 。此外，小组件还可以通过 Apple 推送通知服务（APNs）和 WidgetKit 推送通知来更新其数据。
实况活动不使用时间线来更新其内容。相反，它们使用 ActivityKit 以及你通过 APNs 发送的 ActivityKit 推送通知。欲了解更多信息，请参阅 ActivityKit。
控件也不会使用时间线来更新其内容。相反，它们会在有人使用控件、应用重新加载控件，或系统从 APNs 接收到远程推送通知时更新内容。欲了解更多信息，请参阅本地和远程更新控件 。
为你的小组件和实时活动添加特定的应用功能
默认情况下，用户点击小组件、手表复杂功能或实时活动时，会启动其对应的应用。为了让体验更加直观并减少交互次数，你可以使用深度链接，直接启动与你的小组件可见内容相匹配的应用场景。对于空间足够的小组件（如 WidgetFamily.systemSmall 或更大尺寸）以及在扩展或锁屏外观下的实时活动，可以在视图中添加 SwiftUI 的 Link，让用户能够打开应用中的不同页面。
Note
In iOS 16 and macOS 13 or earlier versions, only large and extra-large widgets can use Link.
小组件通过 App Intents 框架和 SwiftUI，提供了与应用直接交互的能力。Button 和 Toggle 都为此提供了专用的初始化方法。更多信息，请参阅为小组件和实时活动添加交互功能 。
提供可配置的小组件和手表复杂功能
通过提供可配置的小组件和表盘复杂功能，让用户能够选择他们希望在小组件或表盘复杂功能中查看的信息，并为其提供可自定义的属性。例如，用户可以选择在股票市场小组件中关注特定股票，或在包裹快递小组件中输入快递单号。可配置的小组件和表盘复杂功能使用 App Intents 框架以及你自定义的意图——这与支持 Siri 和快捷指令等系统级服务所用的机制相同。关于创建可配置小组件和表盘复杂功能的更多信息，请参阅制作可配置小组件 。
提升在智能叠放中的可见性
在 iPhone 和 iPad 上，用户可以创建小组件堆叠并手动滑动浏览。此外，用户还可以使用智能堆叠和智能旋转功能，查看最相关的小组件并获取小组件建议。为了在智能堆叠顶部显示相关的小组件，iOS 和 iPadOS 会依赖应用在使用过程中提供的行为线索。在 Apple Watch 上，用户可以在智能堆叠中放置并固定小组件，但他们更多地依赖系统自动显示与情境相关的小组件。为了确定最相关的小组件，watchOS 会向您的小组件扩展查询情境线索。
如需了解更多信息，请参阅提升小组件在智能堆叠中的可见性 。
考虑用户隐私
锁屏和表盘始终可见，用户可以配置小组件和复杂功能，在设备锁定或支持常亮显示时隐藏敏感信息。请检查出现在您的小组件、实况活动或复杂功能上的数据，并确保支持对敏感数据的编辑隐藏。更多信息，请参阅创建小组件扩展 。
在群组容器中存储共享数据
要添加小组件、手表复杂功能和实时活动，您需要创建一个小组件扩展并将其添加到您的应用中，该扩展目标和您的应用属于同一个应用群组。因此，您可以将文件和数据存储在一个应用和小组件扩展都能访问的共享容器中。例如，您的应用可以下载数据并将其存储在共享容器中的数据库中，然后小组件可以访问该数据库。
有关应用群组和访问共享容器的更多信息，请参阅配置应用群组 。
遵守功能限制
小组件、手表复杂功能和实时活动始终可见。为了保护电池寿命和用户隐私，它们遵循特定的限制。例如，实时活动无法访问用户的位置。下表显示了影响每项功能电池寿命或用户隐私的可用性特性：
功能
小组件
手表复杂功能
实时活动
网络访问
是
是
否
位置访问
是
是
否
如需更多信息，请参阅在小组件中访问位置信息 。
